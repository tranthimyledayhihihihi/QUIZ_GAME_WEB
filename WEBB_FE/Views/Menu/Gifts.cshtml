@model WEBB.Models.ViewModels.DailyRewardViewModel
@{
    ViewBag.Title = "Thưởng Ngày";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="game-container">
    <div class="card p-4 shadow-lg" style="max-width: 480px; margin: 0 auto;">
        <h3 class="fw-bold mb-3 text-center">
            <i class="fa-solid fa-gift me-2"></i> Thưởng Đăng Nhập Hằng Ngày
        </h3>

        <p class="text-muted text-center">
            @Model.Message
        </p>

        <div class="text-center my-3">
            <div class="display-4 fw-bold">
                🔥 @Model.SoNgayLienTiep ngày liên tiếp
            </div>
            @if (Model.NgayCapNhatCuoi.HasValue)
            {
                <div class="text-secondary mt-2">
                    Cập nhật lần cuối: @Model.NgayCapNhatCuoi.Value.ToString("dd/MM/yyyy")
                </div>
            }
        </div>

        <div class="d-grid gap-2 mt-4">
            <button id="btn-claim" class="btn btn-success btn-lg">
                <i class="fa-solid fa-sack-dollar me-2"></i> Nhận thưởng hôm nay
            </button>
        </div>

        <div id="reward-message" class="alert mt-3 d-none"></div>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            $("#btn-claim").on("click", function () {
                var $btn = $(this);
                $btn.prop("disabled", true).text("Đang xử lý...");

                $.ajax({
                    url: '@Url.Action("ClaimDailyReward", "Menu")',
                    type: 'POST',
                    success: function (res) {
                        // res: { awarded: bool, message: "..." }
                        var awarded = res.awarded ?? res.Awarded;
                        var msg = res.message ?? res.Message;

                        var $alert = $("#reward-message");
                        $alert
                            .removeClass("d-none alert-success alert-warning")
                            .addClass(awarded ? "alert-success" : "alert-warning")
                            .text(msg);

                        if (!awarded) {
                            // đã nhận rồi thì khóa nút
                            $btn.prop("disabled", true)
                                .text("Đã nhận thưởng hôm nay");
                        } else {
                            // nhận thành công: đổi text
                            $btn.text("Đã nhận thưởng hôm nay");
                        }
                    },
                    error: function () {
                        $("#reward-message")
                            .removeClass("d-none")
                            .addClass("alert alert-danger")
                            .text("Có lỗi xảy ra, vui lòng thử lại.");
                        $btn.prop("disabled", false).text("Nhận thưởng hôm nay");
                    }
                });
            });
        });
    </script>
}
